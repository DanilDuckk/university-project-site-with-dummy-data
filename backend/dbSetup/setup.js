import Database from "better-sqlite3";
import bcrypt from 'bcryptjs';

let db;

try {
    db = new Database('database.sqlite', { foreignKeys: true });
    setupDatabase();
} catch (e) {
    console.error(e);
}

function setupDatabase() {
    // Create tables
    const sqlCreateTables = `
        CREATE TABLE IF NOT EXISTS user (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            email TEXT NOT NULL UNIQUE,
            username TEXT NOT NULL,
            password TEXT NOT NULL
        );

        CREATE TABLE IF NOT EXISTS duck (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            image_url TEXT NOT NULL,
            name TEXT NOT NULL,
            user_id INTEGER references user(id),
            likes INTEGER DEFAULT 0
        );

        CREATE TABLE IF NOT EXISTS comment (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            content TEXT NOT NULL,
            user_id INTEGER references user(id),
            duck_id integer references duck(id)
        );
    `;

    db.exec(sqlCreateTables);

    // Insert data
    const sqlInsertData = `
        INSERT OR IGNORE INTO user (email, username, password) VALUES
        ('someEmail@gmail.com', 'First User', '${bcrypt.hashSync('MyAmazingPassword', 10)}'),
        ('someEmail123@gmail.com', 'Second User', '${bcrypt.hashSync('MyWorstPassword', 10)}');

        INSERT OR IGNORE INTO duck (image_url, name, user_id) VALUES
        ('data:image/jpeg;base64,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', 'Duck gang', 65),
        ('https://images.theconversation.com/files/547482/original/file-20230911-16-nwvjjz.jpg?ixlib=rb-4.1.0&rect=0%2C200%2C909%2C578&q=20&auto=format&w=320&fit=clip&dpr=2&usm=12&cs=strip', 'Another amazing duck', 65),
        ('https://www.allaboutbirds.org/guide/assets/og/609757895-1200px.jpg', 'SUPAAA DUCK', 66);

        INSERT OR IGNORE INTO comment (content, user_id, duck_id) VALUES
        ('I do really love this duck', 1, 1),
        ('Absolutely amazing duck', 2, 2);
    `;

    //db.exec(sqlInsertData);
}

export default db;